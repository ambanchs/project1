---
title: 'Project 1: Wrangling, Exploration, Visualization'
author: "SDS322E"
date: ''
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  pdf_document:
    toc: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F,
tidy=TRUE, tidy.opts=list(width.cutoff=60), R.options=list(max.print=100))
```

## Data Wrangling, Exploration, Visualization

### Adriana Banchs, amb8722

#### Introduction 

The data sets used for this project are the World Happiness Report and Socio-Economic Country Profiles. Both of the data are from 2017, so the values can be more easily compared. The World Happiness Report contains data measuring happiness in many different countries, using happiness scores based on different factors, as well as rankings of happiness among the countries. The Socio-Economic Country Profiles data set contains different measures for countries relating to the economy, health, employment, demographics, and more. These two data sets are interesting to compare because different factors, such as GDP and employment rates, can be compared to the happiness scores of different countries to see how they are related, and which factors have the greatest effect on happiness. Some things that are expected are that countries with healthier populations, smaller unemployment rates, and a higher GDP would have higher happiness scores. 

```{R}
library(tidyverse)
library(knitr)
happy <- read_csv("happy.csv")
profile <- read_csv("profile.csv")

profile %>% distinct(country)
```

#### Tidying: Reshaping

If your datasets are tidy already, demonstrate that you can reshape data with pivot wider/longer here (e.g., untidy and then retidy). Alternatively, it may be easier to wait until the wrangling section so you can reshape your summary statistics. Note here if you are going to do this.

```{R}
#untidying
untidy_profile <- profile %>% pivot_wider(names_from="Region", values_from="country") %>% 
  select(49:70, everything())
untidy_profile

untidy_happy <- happy %>% pivot_wider(names_from="Happiness.Rank", values_from="Country") %>% 
  select(11:165, everything())
untidy_happy

#retidying
untidy_profile %>% pivot_longer(1:22, names_to="Region", values_to="country") %>%
  select(country, Region, everything()) %>% na.omit()
untidy_happy %>% pivot_longer(1:155, names_to="Happiness.Rank", values_to="country") %>%
  select(country, Happiness.Rank, everything()) %>% na.omit()

profile %>% separate(`Labour force participation (female/male pop. %)`, into=c("Laborforce_participation_women_%","Laborforce_participation_men_%"), sep="/") %>%
  separate(`Life expectancy at birth (females/males, years)`, into=c("Lifeexpectancy_atbirth_females_yrs", "Lifeexpectancy_atbirth_males_yrs")) %>% separate(`Population age distribution (0-14 / 60+ years, %)`, into=c("Pop_age_dist_0-14yrs_%", "Pop_age_dist_60+yrs_%")) %>% separate(`Pop. using improved drinking water (urban/rural, %)`, into=c("Pop_improveddrinkingwater_urban_%", "Pop_improveddrinkingwater_rural_%")) -> profile
profile
```

Since both data sets were already pretty tidy, the profile data set was first untidied by placing each region name as a column, with the countries as the values. This created many more columns with a lot of NA values, and the variable "Region" was in the column instead of as a variable in the row. This makes it really hard to compare countries of different regions. The profile data set was then tidied by pivoting longer and creating a Region column with all of the regions as values. In the happy data set, it was pivoted wider, creating one column for each country. This is messy and difficult to interpret, so it was pivoted wider to list the countries under one "Country" column. 

After the untidying and retidying was done, some of the variables in the profile data set were separated into two variables. Some of the variables in this data set had two different numbers listed as one, such as the life expectancy at birth being listed as females/males. This variable cannot be interpreted for each gender since both values are listed as one, so it was separated into the life expectancy at birth for men and women separately, separating the values by the forward slash. This separation of variables was done for many that listed two different values as one, in order to create a tidier data set that can be interpreted more easily. 
    
#### Joining/Merging

```{R}
#re-coding variables
profile <- profile %>% mutate(country=case_when(country=="Russian Federation"~"Russia", country=="United States of America"~"United States", country=="China, Hong Kong SAR"~"Hong Kong S.A.R., China", country=="Bolivia (Plurinational State of)"~"Bolivia", country=="Venezuela (Bolivarian Republic of)"~"Venezuela", country=="Viet Nam"~"Vietnam", country=="Iran (Islamic Republic of)"~"Iran", country=="Czechia"~"Czech Republic", country=="Republic of Korea"~"South Korea", country=="Republic of Moldova"~"Moldova", country=="United Republic of Tanzania"~"Tanzania", country=="Democratic Republic of the Congo"~"Congo (Kinshasa)", country=="Congo"~"Congo (Brazzaville)", country=="Syrian Arab Republic"~"Syria",TRUE~country))
profile

profile %>% summarize(n_distinct(country))
happy %>% summarize(n_distinct(Country))

anti_join(happy, profile, by=c("Country"="country"))
anti_join(profile, happy, by=c("country"="Country"))
joined <- inner_join(happy, profile, by=c("Country"="country")) %>% select(Country, Region, everything())
joined
```

Before joining could be performed, it was noticed that the same countries are listed under different names in both data sets. Country names that were found to differ were changed in the profile data set to match the country names of the happy data set. For example, Russia is listed as "Russia" in the happy data set, but it is listed as "Russian Federation" in the profile data set, so it was changed to match the happy data set. An anti-join was used to easily identify and find which countries were listed under different names in order to change them. Once this process was complete, an inner join was performed to join both data sets by the country variable and exclude any rows with no matches. 

In the original profile data set there are 229 observations with 54 variables (columns), and in the happy data set, there are 155 observations with 12 variables (columns). All of the observations in both data sets are unique (229 and 155). After changing the country names so they matched each other on both data sets, there are 6 countries in happy that are not in profile. Some of these are Taiwan Province of China, North Cyprus, and Kosovo. In profile, there are 80 countries not found in the happy data set. Some of these are Andora, Bahamas, and Bermuda. Both data sets have 149 countries in common, so in the final joined data set there are 149 rows.

####  Wrangling

```{R}

#use filter, select, arrange, group_by, mutate, summarize
#stringr function such as str_detect or str_replace_all with regex
#For your categorical variables, report the frequencies/counts of each level.
#report the number of missing values (NAs) for each variable

joined <- joined %>% mutate(Country.size= ifelse(`Population in thousands (2017)`>mean(`Population in thousands (2017)`), "large", "small")) %>% mutate(HappyResult= ifelse(Happiness.Score>mean(Happiness.Score), "Happy", "Sad"))
joined %>% select(1,4, 15,66:67)

joined %>% group_by(Region) %>% summarize(mean_GDP=mean(`GDP per capita (current US$)`), mean_HappyScore=mean(Happiness.Score)) %>% arrange(desc(mean_HappyScore))

joined %>% filter(Region=="NorthernAmerica" | Region=="CentralAmerica" | Region=="SouthAmerica" | Region=="Caribbean") %>% arrange(Happiness.Rank) %>% select(1:3, 46)

joined %>% filter(Region !="NorthernAmerica" & Region !="CentralAmerica" & Region !="SouthAmerica" & Region !="Caribbean") %>% arrange(Happiness.Rank) %>% select(1:3, 46)

#joined %>% filter(`Health: Physicians (per 1000 pop.)`=="...") %>% mutate(Physicians.per.1000= str_replace(`Health: Physicians (per 1000 pop.)`, "...", NA)) #????????

joined %>% group_by(Region) %>% summarize(n())
joined %>% group_by(Country.size) %>% summarize(n())
joined %>% group_by(Region, Country.size) %>% count

joined %>% summarize(sum(is.na))
```

Your discussion of wrangling section here. Feel encouraged to break up into more than once code chunk and discuss each in turn.


#### Visualizing

```{R}
joined %>% ggplot(aes(Happiness.Score, `GDP per capita (current US$)`)) + geom_point(aes(color=Country.size)) + geom_smooth(se=F)

joined %>% ggplot(aes(Happiness.Score, `Health: Physicians (per 1000 pop.)`)) + geom_point()
```

Your discussion of plot 1

```{R}
joined %>% ggplot(aes(Region, Happiness.Score)) + geom_bar(stat ="summary", aes(color=Country.size))
```

Your discussion of plot 2

```{R}
joined %>% ggplot(aes(x=Happiness.Score, y=)) + geom_boxplot() +
  geom_jitter(alpha=.6, aes(color=vore))
```

Your discussion of plot 3

#### Concluding Remarks

If any!




